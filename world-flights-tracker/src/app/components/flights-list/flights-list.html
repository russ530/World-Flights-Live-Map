<div class="container mt-4">
  <!-- Messaggio informativo -->
  <div class="alert alert-info mb-4" *ngIf="!loading">
    <small>
      <strong>‚ÑπÔ∏è Informazioni:</strong> 
      L'API free di Aviationstack restituisce principalmente voli di test concentrati in Asia. 
      Per dati pi√π diversificati sarebbe necessario un piano a pagamento.
      <br>
      <em>Aggiorna la pagina per ottenere un set di voli leggermente diverso.</em>
    </small>
  </div>

  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="mb-1">üõ´ Voli Attivi in Tempo Reale</h2>
      <p class="text-muted mb-0" *ngIf="!loading && !error">
        {{ filteredFlights.length }} di {{ flights.length }} voli
        <span *ngIf="currentFilters.airline || currentFilters.status || currentFilters.departureAirport || currentFilters.arrivalAirport" 
              class="text-primary">(filtrati)</span>
      </p>
    </div>
    <button 
      class="btn btn-primary" 
      (click)="refreshFlights()"
      [disabled]="loading">
      <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
      {{ loading ? 'Caricamento...' : 'üîÑ Aggiorna' }}
    </button>
  </div>

  <!-- Componente Filtri -->
  <app-flight-filter 
    (filtersChanged)="onFiltersChanged($event)">
  </app-flight-filter>

  <!-- Messaggio di caricamento -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Caricamento...</span>
    </div>
    <p class="mt-2">Caricamento voli in corso...</p>
  </div>

  <!-- Messaggio di errore -->
  <div *ngIf="error && !loading" class="alert alert-danger" role="alert">
    {{ error }}
    <button class="btn btn-sm btn-outline-danger ms-2" (click)="loadFlights()">
      Riprova
    </button>
  </div>

  <!-- Tabella voli migliorata -->
  <div *ngIf="!loading && !error" class="table-responsive">
    <table class="table table-striped table-hover table-sm">
      <thead class="table-dark">
        <tr>
          <th>Volo</th>
          <th>Compagnia</th>
          <th>Partenza</th>
          <th>Arrivo</th>
          <th>Data</th>
          <th>Partenza</th>
          <th>Arrivo</th>
          <th>Durata</th>
          <th>Stato</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let flight of filteredFlights" class="flight-row">
          <td>
            <strong>{{ getFlightNumber(flight) }}</strong>
          </td>
          <td>
            <span class="airline-icon me-1">
              {{ getAirlineIcon(getAirlineIata(flight)) }}
            </span>
            {{ getAirlineName(flight) }}
          </td>
          <td>
            <div class="airport-code">{{ getDepartureAirport(flight) }}</div>
            <small class="text-muted">{{ getDepartureAirportName(flight) }}</small>
          </td>
          <td>
            <div class="airport-code">{{ getArrivalAirport(flight) }}</div>
            <small class="text-muted">{{ getArrivalAirportName(flight) }}</small>
          </td>
          <td>{{ formatDate(flight.flight_date) }}</td>
          <td>
            <strong>{{ getDisplayTime(flight, 'departure') }}</strong>
          </td>
          <td>
            <strong>{{ getDisplayTime(flight, 'arrival') }}</strong>
          </td>
          <td>
            <span class="duration-badge">
              {{ getDisplayDuration(flight) }}
            </span>
          </td>
          <td>
            <span [class]="getStatusBadgeClass(flight.flight_status)" class="badge">
              {{ getStatusText(flight.flight_status) }}
            </span>
          </td>
        </tr>
      </tbody>
    </table>
    
    <div *ngIf="filteredFlights.length === 0" class="text-center py-4">
      <p class="text-muted" *ngIf="flights.length > 0">
        Nessun volo trovato con i filtri selezionati.
      </p>
      <p class="text-muted" *ngIf="flights.length === 0">
        Nessun volo attivo trovato.
      </p>
    </div>
  </div>

  <!-- Sezione Mappa -->
  <div *ngIf="!loading && !error && filteredFlights.length > 0" class="mt-5">
    <app-flight-map [flights]="filteredFlights"></app-flight-map>
  </div>
</div>